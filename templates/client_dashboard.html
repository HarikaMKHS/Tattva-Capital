<!-- templates/client_dashboard.html -->
<!DOCTYPE html>
<html>
<head>
  <title>Client Dashboard</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body style="font-family: sans-serif; text-align: center;">
  <h2>Enter your Client Code</h2>
  <form method="POST" action="/dashboard-form">
    <input type="text" name="client_id" required placeholder="Client Code">
    <button type="submit">View Dashboard</button>
  </form>

  {% if error %}
    <p style="color:red">{{ error }}</p>
  {% endif %}

  {% if client_data %}
    <h3>Dashboard Details</h3>
    <table border="1" cellpadding="10" id="dashboardTable" style="margin:auto;">
      {% for key, value in client_data.items() %}
        <tr>
          <th>{{ key }}</th>
          <td>{{ value }}</td>
        </tr>
      {% endfor %}
    </table>

    <br>
    <button onclick="downloadPDF()">Download as PDF</button>
  {% endif %}

  <script>
    function downloadPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.text("Client Dashboard Report", 20, 20);
      const rows = [];

      document.querySelectorAll("#dashboardTable tr").forEach(row => {
        const cols = row.querySelectorAll("th, td");
        rows.push([cols[0].innerText, cols[1].innerText]);
      });

      let y = 30;
      rows.forEach(row => {
        doc.text(`${row[0]}: ${row[1]}`, 20, y);
        y += 10;
      });

      doc.save("client_dashboard.pdf");
    }
  </script>
</body>
</html>
